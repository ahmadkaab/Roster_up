{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Roster_up/rosterup-web/src/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n  const cookieStore = await cookies()\r\n\r\n  return createServerClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n    {\r\n      cookies: {\r\n        getAll() {\r\n          return cookieStore.getAll()\r\n        },\r\n        setAll(cookiesToSet) {\r\n          try {\r\n            cookiesToSet.forEach(({ name, value, options }) =>\r\n              cookieStore.set(name, value, options)\r\n            )\r\n          } catch {\r\n            // The `setAll` method was called from a Server Component.\r\n            // This can be ignored if you have middleware refreshing\r\n            // user sessions.\r\n          }\r\n        },\r\n      },\r\n    }\r\n  )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,6JAAO;IAEjC,OAAO,IAAA,kNAAkB,sUAGvB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACnB;YACF;QACF;IACF;AAEJ"}},
    {"offset": {"line": 36, "column": 0}, "map": {"version":3,"sources":["file:///D:/Roster_up/rosterup-web/src/actions/friends.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\nexport async function sendFriendRequest(friendId: string) {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n\r\n  // Check if request already exists (in either direction)\r\n  const { data: existing } = await supabase\r\n    .from(\"friendships\")\r\n    .select(\"*\")\r\n    .or(`and(user_id.eq.${user.id},friend_id.eq.${friendId}),and(user_id.eq.${friendId},friend_id.eq.${user.id})`)\r\n    .single();\r\n\r\n  if (existing) {\r\n    if (existing.status === 'accepted') throw new Error(\"Already friends\");\r\n    if (existing.status === 'pending') throw new Error(\"Request already pending\");\r\n    if (existing.status === 'blocked') throw new Error(\"Cannot send request\");\r\n  }\r\n\r\n  const { error } = await supabase\r\n    .from(\"friendships\")\r\n    .insert({\r\n      user_id: user.id,\r\n      friend_id: friendId,\r\n      status: \"pending\",\r\n    });\r\n\r\n  if (error) throw error;\r\n  revalidatePath(\"/dashboard\");\r\n  revalidatePath(`/player/${friendId}`);\r\n}\r\n\r\nexport async function acceptFriendRequest(friendshipId: string) {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n\r\n  const { error } = await supabase\r\n    .from(\"friendships\")\r\n    .update({ status: \"accepted\", updated_at: new Date().toISOString() })\r\n    .eq(\"id\", friendshipId)\r\n    .eq(\"friend_id\", user.id); // Only the recipient can accept\r\n\r\n  if (error) throw error;\r\n  revalidatePath(\"/dashboard\");\r\n}\r\n\r\nexport async function rejectFriendRequest(friendshipId: string) {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n\r\n  const { error } = await supabase\r\n    .from(\"friendships\")\r\n    .update({ status: \"rejected\", updated_at: new Date().toISOString() })\r\n    .eq(\"id\", friendshipId)\r\n    .eq(\"friend_id\", user.id);\r\n\r\n  if (error) throw error;\r\n  revalidatePath(\"/dashboard\");\r\n}\r\n\r\nexport async function removeFriend(friendshipId: string) {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) throw new Error(\"Unauthorized\");\r\n\r\n  const { error } = await supabase\r\n    .from(\"friendships\")\r\n    .delete()\r\n    .eq(\"id\", friendshipId)\r\n    // Ensure user is part of the friendship\r\n    .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`);\r\n\r\n  if (error) throw error;\r\n  revalidatePath(\"/dashboard\");\r\n}\r\n\r\nexport async function getFriends() {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) return [];\r\n\r\n  const { data: friendships } = await supabase\r\n    .from(\"friendships\")\r\n    .select(`\r\n      id,\r\n      user_id,\r\n      friend_id,\r\n      status,\r\n      friend:friend_id(email), \r\n      user:user_id(email)\r\n    `) // Note: This assumes we can fetch email, but ideally we fetch profiles\r\n    .eq(\"status\", \"accepted\")\r\n    .or(`user_id.eq.${user.id},friend_id.eq.${user.id}`);\r\n\r\n  // We need to fetch profiles manually or via join if profiles table is linked\r\n  // For now, let's assume we need to fetch profiles separately or rely on what we have.\r\n  // A better approach is to fetch the profile of the \"other\" person.\r\n  \r\n  if (!friendships) return [];\r\n\r\n  const friendIds = friendships.map(f => f.user_id === user.id ? f.friend_id : f.user_id);\r\n  const friendshipMap = new Map(friendships.map(f => [\r\n    f.user_id === user.id ? f.friend_id : f.user_id, \r\n    f.id\r\n  ]));\r\n  \r\n  const { data: profiles } = await supabase\r\n    .from(\"player_cards\")\r\n    .select(\"player_id, ign, primary_role, game\")\r\n    .in(\"player_id\", friendIds);\r\n\r\n  return profiles?.map(p => ({\r\n    ...p,\r\n    friendship_id: friendshipMap.get(p.player_id)\r\n  })) || [];\r\n}\r\n\r\nexport async function getPendingRequests() {\r\n  const supabase = await createClient();\r\n  const { data: { user } } = await supabase.auth.getUser();\r\n\r\n  if (!user) return { incoming: [], outgoing: [] };\r\n\r\n  const { data: incoming } = await supabase\r\n    .from(\"friendships\")\r\n    .select(\"*, user:user_id(email)\") // Sender info\r\n    .eq(\"friend_id\", user.id)\r\n    .eq(\"status\", \"pending\");\r\n\r\n  const { data: outgoing } = await supabase\r\n    .from(\"friendships\")\r\n    .select(\"*, friend:friend_id(email)\") // Recipient info\r\n    .eq(\"user_id\", user.id)\r\n    .eq(\"status\", \"pending\");\r\n\r\n    // Fetch profiles for better display\r\n    const incomingIds = incoming?.map(f => f.user_id) || [];\r\n    const outgoingIds = outgoing?.map(f => f.friend_id) || [];\r\n\r\n    const { data: profiles } = await supabase\r\n        .from(\"player_cards\")\r\n        .select(\"player_id, ign\")\r\n        .in(\"player_id\", [...incomingIds, ...outgoingIds]);\r\n\r\n    const profileMap = new Map(profiles?.map(p => [p.player_id, p]));\r\n\r\n    const incomingWithProfiles = incoming?.map(req => ({\r\n        ...req,\r\n        sender_profile: profileMap.get(req.user_id)\r\n    }));\r\n\r\n    const outgoingWithProfiles = outgoing?.map(req => ({\r\n        ...req,\r\n        recipient_profile: profileMap.get(req.friend_id)\r\n    }));\r\n\r\n  return { incoming: incomingWithProfiles || [], outgoing: outgoingWithProfiles || [] };\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///D:/Roster_up/rosterup-web/.next-internal/server/app/player/%5Bid%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendFriendRequest as '401dc02dc6c8f3e61f24e9c38f70383e04e10ee295'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}